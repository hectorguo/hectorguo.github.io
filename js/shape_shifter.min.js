var S={init:function(a,b){S.Drawing.init(a),document.body.classList.add("canvas-ready"),S.UI.simulate(b),S.Drawing.loop(function(){S.Shape.render()})}};S.Drawing=function(){var a,b,c;return requestFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},{init:function(c){a=document.querySelector(c),b=a.getContext("2d"),this.adjustCanvas(),window.addEventListener("resize",function(a){S.Drawing.adjustCanvas()})},loop:function(a){c=c?c:a,this.clearFrame(),c(),requestFrame.call(window,this.loop.bind(this))},adjustCanvas:function(){a.width=window.innerWidth,a.height=window.innerHeight},clearFrame:function(){b.clearRect(0,0,a.width,a.height)},getArea:function(){return{w:a.width,h:a.height}},drawCircle:function(a,c){b.fillStyle=c.render(),b.beginPath(),b.arc(a.x,a.y,a.z,0,2*Math.PI,!0),b.closePath(),b.fill()}}}(),S.UI=function(){function k(a){var b=a.getHours(),c=a.getMinutes(),c=c<10?"0"+c:c;return b+":"+c}function l(a){return a&&a.split(" ")[1]}function m(a){return a=a&&a.split(" ")[0],a&&a[0]===j&&a.substring(1)}function n(a,c,e,f){clearInterval(b),d=f?e:1,a(d),(!e||!f&&d<e||f&&d>0)&&(b=setInterval(function(){d=f?d-1:d+1,a(d),(!f&&e&&d===e||f&&0===d)&&clearInterval(b)},c))}function p(a){var b,a,c;i="object"==typeof a?a:i.concat(a.split("|")),n(function(d){switch(c=i.shift(),b=m(c),a=l(c),b){case"countdown":a=parseInt(a)||10,a=a>0?a:10,n(function(a){0===a?0===i.length?S.Shape.switchShape(S.ShapeBuilder.letter("")):p(i):S.Shape.switchShape(S.ShapeBuilder.letter(a),!0)},1e3,a,!0);break;case"rectangle":a=a&&a.split("x"),a=a&&2===a.length?a:[g,g/2],S.Shape.switchShape(S.ShapeBuilder.rectangle(Math.min(g,parseInt(a[0])),Math.min(g,parseInt(a[1]))));break;case"circle":a=parseInt(a)||g,a=Math.min(a,g),S.Shape.switchShape(S.ShapeBuilder.circle(a));break;case"time":var e=k(new Date);i.length>0?S.Shape.switchShape(S.ShapeBuilder.letter(e)):n(function(){e=k(new Date),e!==f&&(f=e,S.Shape.switchShape(S.ShapeBuilder.letter(f)))},1e3);break;default:S.Shape.switchShape(S.ShapeBuilder.letter(c[0]===j?"What?":c))}},2e3,i.length)}function q(){c&&document.body.classList.add("touch")}var b,d,f,c=(document.querySelector(".canvas"),!1),g=30,i=[],j="#";return q(),{simulate:function(a){p(a)}}}(),S.Point=function(a){this.x=a.x,this.y=a.y,this.z=a.z,this.a=a.a,this.h=a.h},S.Color=function(a,b,c,d){this.r=a,this.g=b,this.b=c,this.a=d},S.Color.prototype={render:function(){return"rgba("+this.r+","+ +this.g+","+this.b+","+this.a+")"}},S.Dot=function(a,b){this.p=new S.Point({x:a,y:b,z:5,a:1,h:0}),this.e=.07,this.s=!0,this.c=new S.Color(51,51,51,this.p.a),this.t=this.clone(),this.q=[]},S.Dot.prototype={clone:function(){return new S.Point({x:this.x,y:this.y,z:this.z,a:this.a,h:this.h})},_draw:function(){this.c.a=this.p.a,S.Drawing.drawCircle(this.p,this.c)},_moveTowards:function(a){var b=this.distanceTo(a,!0),c=b[0],d=b[1],e=b[2],f=this.e*e;if(this.p.h===-1)return this.p.x=a.x,this.p.y=a.y,!0;if(e>1)this.p.x-=c/e*f,this.p.y-=d/e*f;else{if(!(this.p.h>0))return!0;this.p.h--}return!1},_update:function(){if(this._moveTowards(this.t)){var a=this.q.shift();a?(this.t.x=a.x||this.p.x,this.t.y=a.y||this.p.y,this.t.z=a.z||this.p.z,this.t.a=a.a||this.p.a,this.p.h=a.h||0):this.s?(this.p.x-=Math.sin(3.142*Math.random()),this.p.y-=Math.sin(3.142*Math.random())):this.move(new S.Point({x:this.p.x+50*Math.random()-25,y:this.p.y+50*Math.random()-25}))}d=this.p.a-this.t.a,this.p.a=Math.max(.1,this.p.a-.05*d),d=this.p.z-this.t.z,this.p.z=Math.max(1,this.p.z-.05*d)},distanceTo:function(a,b){var c=this.p.x-a.x,d=this.p.y-a.y,e=Math.sqrt(c*c+d*d);return b?[c,d,e]:e},move:function(a,b){(!b||b&&this.distanceTo(a)>1)&&this.q.push(a)},render:function(){this._update(),this._draw()}},S.ShapeBuilder=function(){function f(){b.width=Math.floor(window.innerWidth/a)*a,b.height=Math.floor(window.innerHeight/a)*a,c.fillStyle="red",c.textBaseline="middle",c.textAlign="center"}function g(){var d=c.getImageData(0,0,b.width,b.height).data;dots=[],x=0,y=0,fx=b.width,fy=b.height,w=0,h=0;for(var e=0;e<d.length;e+=4*a)d[e+3]>0&&(dots.push(new S.Point({x:x,y:y})),w=x>w?x:w,h=y>h?y:h,fx=x<fx?x:fx,fy=y<fy?y:fy),x+=a,x>=b.width&&(x=0,y+=a,e+=4*a*b.width);return{dots:dots,w:w+fx,h:h+fy}}function i(a){c.font="bold "+a+"px "+e}function j(a){return!isNaN(parseFloat(a))&&isFinite(a)}function k(){f(),window.addEventListener("resize",f)}var a=13,b=document.createElement("canvas"),c=b.getContext("2d"),d=500,e="Avenir, Helvetica Neue, Helvetica, Arial, sans-serif";return k(),{imageFile:function(a,d){var e=new Image,f=S.Drawing.getArea();e.onload=function(){c.clearRect(0,0,b.width,b.height),c.drawImage(this,0,0,.6*f.h,.6*f.h),d(g())},e.onerror=function(){d(S.ShapeBuilder.letter("What?"))},e.src=a},circle:function(d){var e=Math.max(0,d)/2;return c.clearRect(0,0,b.width,b.height),c.beginPath(),c.arc(e*a,e*a,e*a,0,2*Math.PI,!1),c.fill(),c.closePath(),g()},letter:function(a){var e=0;return i(d),e=Math.min(d,b.width/c.measureText(a).width*.8*d,b.height/d*(j(a)?1:.45)*d),i(e),c.clearRect(0,0,b.width,b.height),c.fillText(a,b.width/2,b.height/2),g()},rectangle:function(b,c){for(var d=[],e=a*b,f=a*c,g=0;g<f;g+=a)for(var h=0;h<e;h+=a)d.push(new S.Point({x:h,y:g}));return{dots:d,w:e,h:f}}}}(),S.Shape=function(){function f(){var a=S.Drawing.getArea();d=a.w/2-b/2,e=a.h/2-c/2}var a=[],b=0,c=0,d=0,e=0;return{shuffleIdle:function(){for(var b=S.Drawing.getArea(),c=0;c<a.length;c++)a[c].s||a[c].move({x:Math.random()*b.w,y:Math.random()*b.h})},switchShape:function(g,h){var i,j=S.Drawing.getArea();if(b=g.w,c=g.h,f(),g.dots.length>a.length){i=g.dots.length-a.length;for(var k=1;k<=i;k++)a.push(new S.Dot(j.w/2,j.h/2))}for(var k=0,l=0;g.dots.length>0;)l=Math.floor(Math.random()*g.dots.length),a[k].e=h?.25:a[k].s?.14:.11,a[k].s?a[k].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:18})):a[k].move(new S.Point({z:5*Math.random()+5,h:h?18:30})),a[k].s=!0,a[k].move(new S.Point({x:g.dots[l].x+d,y:g.dots[l].y+e,a:1,z:5,h:0})),g.dots=g.dots.slice(0,l).concat(g.dots.slice(l+1)),k++;for(var l=k;l<a.length;l++)a[l].s&&(a[l].move(new S.Point({z:20*Math.random()+10,a:Math.random(),h:20})),a[l].s=!1,a[l].e=.04,a[l].move(new S.Point({x:Math.random()*j.w,y:Math.random()*j.h,a:.3,z:4*Math.random(),h:0})))},render:function(){for(var b=0;b<a.length;b++)a[b].render()}}}();